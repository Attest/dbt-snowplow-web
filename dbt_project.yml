
name: 'snowplow_dbt_web'
version: '0.1.0'
config-version: 2

# This setting configures which "profile" dbt uses for this project.
profile: 'default'

# These configurations specify where dbt should look for different types of files.
# The `source-paths` config, for example, states that models in this project can be
# found in the "models/" directory. You probably won't need to change these!
source-paths: ["models"]
analysis-paths: ["analysis"]
test-paths: ["tests"]
data-paths: ["data"]
macro-paths: ["macros"]
snapshot-paths: ["snapshots"]

target-path: "target"  # directory which will store compiled SQL files
clean-targets:         # directories to be removed by `dbt clean`
    - "target"
    - "dbt_modules"

vars:
  start_date: '2020-01-01'
  lookback_window_hours: 6
  backfill_limit_days: 7
  session_lookback_days: 365
  days_late_allowed: 3
  # snowplow_atomic_schema: atomic
  # atomic_events_table: events
  # page_view_context_table: com_snowplowanalytics_snowplow_web_page_1
  snowplow_atomic_schema: scratch
  atomic_events_table: events_dbt_equality
  page_view_context_table: com_snowplowanalytics_snowplow_web_page_1_dbt_equality
  iab_context_table: com_iab_snowplow_spiders_and_robots_1
  ua_parser_context_table: com_snowplowanalytics_snowplow_ua_parser_context_1
  yauaa_context_table: nl_basjes_yauaa_context_1
  enable_iab: false
  enable_ua: false
  enable_yauaa: false
  # can probably remove these flags by setting to disabled under models:
  enable_derived_page_views: true
  enable_derived_sessions: true
  enable_derived_users: true
  ua_bot_filter: true
  minimumVisitLength: 5
  heartbeat: 10
  upsert_lookback_days: 30
  app_id: []


# Commits events to event manifest if the run completes sucessfully
on-run-start: "{{ snowplow_dbt_utils.snowplow_incremental_pre_hook('snowplow_web') }}"
on-run-end: "{{ snowplow_dbt_utils.snowplow_incremental_post_hook('snowplow_web') }}"


# Tag 'snowplow_web_incremental' allows snowplow_incremental_post_hook to identify Snowplow models
# and add their last sucessfull collector_tstamp to the manifest.
models:
  snowplow_dbt_web:
    base:
      # Change back to derived
      +schema: scratch 
      scratch:
        +schema: scratch
        redshift:
          enabled: "{{ target.type == 'redshift' | as_bool() }}"
    page_views:
      +tags: snowplow_web_incremental
      +schema: derived
      scratch:
        +schema: scratch
        redshift:
          enabled: "{{ target.type == 'redshift' | as_bool() }}"
    sessions:
      +tags: snowplow_web_incremental
      +schema: derived
      scratch:
        +schema: scratch
    users:
      +tags: snowplow_web_incremental
      +schema: derived
      scratch:
        +schema: scratch
